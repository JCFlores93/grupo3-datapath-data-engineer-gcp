
create or replace table `proyectolab01caqh.proyecto_stagging.classicmodels` as ( with payments as ( select customerNumber, round(sum(amount),1) as amount from `proyectolab01caqh.proyecto_quality.payments` group by customerNumber ), customer as ( SELECT a.customerNumber, a.customerName, a.contactLastName, a.contactFirstName, a.phone, a.addressLine1, a.addressLine2, a.city, a.state, a.postalCode, a.country, a.salesRepEmployeeNumber, a.creditLimit, b.amount, c.employeeNumber, c.lastName, c.firstName, c.extension, c.email, c.officeCode, c.reportsTo, c.jobTitle, d.city as cityEmployee, d.state as stateEmployee, d.country as countryEmployee, d.territory as territoryEmployee FROM `proyectolab01caqh.proyecto_quality.customers` a inner join payments b on (a.customerNumber = b.customerNumber) inner join `proyectolab01caqh.proyecto_quality.employees` c on (a.salesRepEmployeeNumber =c.employeeNumber) inner join `proyectolab01caqh.proyecto_quality.offices` d on (c.officeCode = d.officeCode) ), orderdetalle as ( select a.orderNumber, a.productCode, a.quantityOrdered, a.priceEach, a.orderLineNumber, b.productName, b.productLine, b.productScale, b.productVendor, b.productDescription, b.quantityInStock, b.buyPrice, b.MSRP, c.textDescription, c.htmlDescription, c.image from `proyectolab01caqh.proyecto_quality.orderdetails` a inner join `proyectolab01caqh.proyecto_quality.products` b on (a.productCode = b.productCode) inner join `proyectolab01caqh.raw.productlines` c on (b.productLine = c.productLine) ) select a.productCode, a.quantityOrdered, a.priceEach, a.orderLineNumber, a.productName, a.productLine, a.productScale, a.productVendor, a.productDescription, a.quantityInStock, a.buyPrice, a.MSRP, a.textDescription, a.htmlDescription, a.image, a.orderNumber, b.orderDate, b.requiredDate, b.shippedDate, b.status, b.customerNumber, c.customerName, c.contactLastName, c.contactFirstName, c.phone, c.addressLine1, c.addressLine2, c.city, c.state, c.postalCode, c.country, c.salesRepEmployeeNumber, c.creditLimit, c.amount, c.employeeNumber, c.lastName, c.firstName, c.extension, c.email, c.officeCode, c.reportsTo, c.jobTitle, c.cityEmployee, c.stateEmployee, c.countryEmployee, c.territoryEmployee from orderdetalle a inner join `proyectolab01caqh.proyecto_quality.orders` b on (a.orderNumber = b.orderNumber) inner join customer c on (b.customerNumber = c.customerNumber) )